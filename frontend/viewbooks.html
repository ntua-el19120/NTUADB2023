<!DOCTYPE html>
<html>
<head>
  <title>Pecaboooooooooo</title>
  <style>
    /* CSS for the table and scrolling */
    #results-container {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
      grid-gap: 20px;
    }

    .book-card {
      border: 1px solid #ddd;
      padding: 10px;
      position: relative;
    }

    .book-card img {
      width: 100%;
      cursor: pointer;
    }

    .book-card h2 {
      margin-top: 10px;
      font-size: 16px;
    }

    .book-card p {
      margin: 5px 0;
      font-size: 12px;
    }

    .summary {
      display: none;
      font-size: 12px;
    }

    .categories {
      margin-top: 10px;
    }

    .category {
      display: inline-block;
      background-color: #ddd;
      padding: 2px 5px;
      margin-right: 5px;
      margin-bottom: 5px;
      border-radius: 3px;
      font-size: 12px;
    }

    .edit-button {
      display: block;
      margin-top: 10px;
      font-size: 12px;
    }

    .delete-button {
      position: absolute;
      bottom: 5px;
      right: 5px;
      background-color: #ff0000;
      color: #fff;
      border: none;
      border-radius: 50%;
      width: 24px;
      height: 24px;
      font-size: 16px;
      display: flex;
      align-items: center;
      justify-content: center;
      cursor: pointer;
    }
  </style>
</head>
<body>
  <h1>Check all the Books</h1>
  <form id="search-form">
    <input type="text" name="Title" placeholder="Title">
    <input type="text" name="Category" placeholder="Category">
    <input type="text" name="Publisher" placeholder="Publisher">
    <input type="text" name="Copies" placeholder="Copies">
    <button type="submit">Search</button>
  </form>

  <div id="results-container"></div>

  <script>
    const form = document.getElementById('search-form');
    const resultsContainer = document.getElementById('results-container');

    form.addEventListener('submit', async (e) => {
      e.preventDefault();
      searchBooks();
    });

    async function searchBooks() {
      // Get the form inputs
      const Category = form.Category.value;
      const Title = form.Title.value;
      const Publisher = form.Publisher.value;
      const Copies = form.Copies.value;

      // Build the query string with search parameters
      const queryParams = new URLSearchParams();
      queryParams.append('Category', Category);
      queryParams.append('Title', Title);
      queryParams.append('Publisher', Publisher);
      queryParams.append('Copies', Copies);

      try {
        // Fetch the search results from the server
        const response = await fetch(`/libq/schooladmin/viewbooks?${queryParams.toString()}`);
        const data = await response.json();

        // Clear previous results
        resultsContainer.innerHTML = '';

        // Display the search results as book cards
        for (const item of data) {
          const card = document.createElement('div');
          card.classList.add('book-card');
          card.setAttribute('data-isbn', item['ISBN']); // Add the data-isbn attribute
          card.innerHTML = `
            <img src="${item['Picture']}" alt="Book Image" onclick="toggleSummary(this)">
            <h2>${item['Title']}</h2>
            <p><strong>Publisher:</strong> ${item['Publisher']}</p>
            <p><strong>No. of Pages:</strong> ${item['PageNumber']}</p>
            <p class="summary" style="display: none;"><strong>Summary:</strong> ${item['Summary']}</p>
            <p><strong>Language:</strong> ${item['Language']}</p>
            <p><strong>Rating:</strong> ${item['Rating']}</p>
            <p><strong>Copies:</strong> ${item['Copies']}</p>
            <p><strong>Available Copies:</strong> ${item['AvailableCopies']}</p>
            <div class="categories">
              <strong>Categories:</strong>
              ${item['Categories'].split(',').map(category => `<span class="category">${category}</span>`).join('')}
            </div>
            <button class="edit-button" onclick="editBook('${item['ISBN']}')">Edit Book</button>
            <button class="delete-button" onclick="deleteBook('${item['ISBN']}')">üóëÔ∏è</button>
          `;

          resultsContainer.appendChild(card);
        }
      } catch (error) {
        console.error(error);
      }
    }

    // Trigger the search when the page loads
    searchBooks();

    function toggleSummary(image) {
      const card = image.parentNode;
      const summary = card.querySelector('.summary');
      summary.style.display = summary.style.display === 'none' ? 'block' : 'none';
    }

    function editBook(ISBN) {
      // Redirect to the edit book page with the appropriate ISBN parameter
      window.location.href = `/libq/schooladmin/editbook/${ISBN}`;
    }

function deleteBook(ISBN) {
  // Display a confirmation dialog
  if (confirm("Are you sure you want to delete this book?")) {
    // Send a DELETE request to the server to delete the book
    fetch(`/libq/schooladmin/viewbooks/deletebook/${ISBN}`, { method: 'DELETE' })
      .then(response => {
        if (response.ok) {
          // Book deleted successfully, remove the book card from the UI
          const card = document.querySelector(`.book-card[data-isbn="${ISBN}"]`);
          card.remove();
        } else {
          throw new Error('Failed to delete book');
        }
      })
      .catch(error => {
        console.error(error);
      });
  }
}

  </script>
  <h3><a href="http://localhost:9103/libq/user">Back to the homepage</a></h3>
</body>
</html>
