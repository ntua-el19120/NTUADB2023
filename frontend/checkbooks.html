<!DOCTYPE html>
<html>
<head>
  <title>3.3.1 Query</title>
  <style>
    /* CSS for the table and scrolling */
    #results-table {
      width: 100%;
      border-collapse: collapse;
      table-layout: fixed;
    }

/* CSS for the Actions column */
#results-table th.actions-header,
#results-table td.actions-cell {
  border: none;
  padding: 0;
  text-align: center;
  line-height: 0;
}


    #results-table th,
    #results-table td {
      padding: 8px;
      border: 1px solid #ddd;
    }

    #results-container {
      height: 60vh; /* Set the table height to 60% of the viewport height */
      overflow-y: auto; /* Enable vertical scrolling if needed */
    }


    /* CSS for wrapping text */
    .wrap-text {
      white-space: normal;
      word-wrap: break-word;
    }

    /* CSS for smaller font size */
    .small-text {
      font-size: 12px;
    }

    /* CSS for narrower columns */
    .narrow-column {
      width: 80px; /* Adjust the width as desired */
    }

    /* CSS for wider summary column */
    .wide-summary {
      width: 300px; /* Adjust the width as desired */
    }

    /* CSS for larger book images */
    .book-image {
      max-width: 200px; /* Adjust the width as desired */
      max-height: 200px; /* Adjust the height as desired */
    }

    /* CSS for the "Choose" button */
.choose-button {
  display: flex;
  justify-content: center;
  align-items: center;
  width: 100%;
}

  </style>
</head>
<body>
  <h1>Check all the Books</h1>
  <form id="search-form">
    <input type="text" name="Title" placeholder="Title">
    <input type="text" name="Category" placeholder="Category">
    <input type="text" name="Publisher" placeholder="Publisher">
    <button type="submit">Search</button>
  </form>

  <div id="results-container">
    <table id="results-table">
        <thead>
            <tr>
              <th class="narrow-column">ISBN</th>
              <th>Title</th>
              <th>Publisher</th>
              <th class="narrow-column">No. of Pages</th>
              <th class="wide-summary">Summary</th>
              <th>Where you can see the picture</th>
              <th class="narrow-column small-text">Language</th>
              <th class="narrow-column small-text">Rating</th>
              <th class="narrow-column small-text">Available Copies</th>
              <th>Categories</th>
              <th class="actions-header"></th>
            </tr>
          </thead>
          
        <tbody id="results"></tbody>
      </table>
    
  </div>

  <script>
    const form = document.getElementById('search-form');
    const resultsContainer = document.getElementById('results');

    form.addEventListener('submit', async (e) => {
      e.preventDefault();

      // Get the form inputs
      const Category = form.Category.value;
      const Title = form.Title.value;
      const Publisher = form.Publisher.value;


      // Build the query string with search parameters
      const queryParams = new URLSearchParams();
      queryParams.append('Category', Category);
      queryParams.append('Title', Title);
      queryParams.append('Publisher', Publisher);

      try {
        // Fetch the search results from the server
        const response = await fetch(`/libq/user/checkbooks?${queryParams.toString()}`);
        const data = await response.json();

        // Clear previous results
        resultsContainer.innerHTML = '';

        // Display the search results in the table
        for (const item of data) {
          const row = document.createElement('tr');
          row.innerHTML = `
            <td class="small-text narrow-column">${item['ISBN']}</td>
            <td>${item['Title']}</td>
            <td>${item['Publisher']}</td>
            <td class="small-text narrow-column">${item['PageNumber']}</td>
            <td class="truncate">${item['Summary']}</td>
            <td><img src="${item['Picture']}" alt="Book Image" class="book-image"></td>
            <td class="small-text narrow-column">${item['Language']}</td>
            <td>${item['Rating']}</td>
            <td>${item['AvailableCopies']}</td>
            <td class="wrap-text">${item['Categories']}</td>
          `;
          const chooseButton = document.createElement('button');
chooseButton.textContent = 'Choose';
chooseButton.classList.add('choose-button');
chooseButton.addEventListener('click', () => {
  chooseBook(item['ISBN']); // Call the chooseBook function with the ISBN parameter
});

  // Create a table cell for the button and append the button to it
const actionCell = document.createElement('td');
actionCell.classList.add('actions-cell');
actionCell.appendChild(chooseButton);



  // Append the action cell to the table row
  row.appendChild(actionCell);

  // Append the row to the results container
  resultsContainer.appendChild(row);
        }
      } catch (error) {
        console.error(error);
      }
    });

    function chooseBook(ISBN) {
  // Redirect to the chosenbook route with the appropriate ISBN parameter
  window.location.href = `/libq/user/chosenbook/${ISBN}`;
}
  </script>
  <h3><a href="http://localhost:9103/libq/user">Back to the homepage</a></h3>
</body>
</html>
